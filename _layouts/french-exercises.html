---
layout: default
---

{%- include header.html -%}

<div id="main" class="page">
	<!-- Page -->
	<article class="shade-two">
	  <div class="container">
	    <!-- Exercise data for JavaScript -->
	    <script type="application/json" id="exercise-data-futur-proche">{{ site.data.exercises.futur-proche | jsonify }}</script>
	    <script type="application/json" id="exercise-data-imparfait">{{ site.data.exercises.imparfait | jsonify }}</script>
	    <script type="application/json" id="exercise-data-passe-compose">{{ site.data.exercises.passe-compose | jsonify }}</script>
	    <script type="application/json" id="exercise-data-futur-simple">{{ site.data.exercises.futur-simple | jsonify }}</script>
	    
	    <!-- Extract and display headers separately -->
	    <div class="page-headers">
	      <h1>{{ page.title }} - Interactive Exercises</h1>
	      <p>Complete the sentence with the correct form of the verb in {{ page.title | downcase }}.</p>
	    </div>
	    
	    <!-- Exercise interface below the headers -->
	    <div class="exercise-content">
	      <div class="sentence-container">
	        <div id="sentence-display" class="sentence-text"></div>
	        <div class="answer-section">
	          <input type="text" id="answer-input" placeholder="Type your answer here..." class="answer-input">
	          <button id="check-answer-btn" class="check-button">Check Answer</button>
	          <button id="show-answer-btn" class="show-button">Show Answer</button>
	        </div>
	        <div id="feedback" class="feedback"></div>
	        <button id="new-exercise-btn" class="exercise-button">
	          <i class="fa fa-forward"></i> New Exercise
	        </button>
	      </div>
	    </div>
	    
	    <!-- Content (Grammar Tips) below the exercise -->
	    {{- content -}}
	  </div>
	</article>
	<a href="{{- post.url | relative_url -}}" class="back-to-top">{{ site.data.ui-text[site.locale].back_to_top | default: 'Back to Top' }} &uarr;</a>
</div>

<script>
// French grammar exercise system - handles all exercise logic
class FrenchExerciseSystem {
  constructor() {
    this.currentExerciseIndex = 0;
    this.exercises = [];
    this.init();
  }

  init() {
    // Get exercise data from Jekyll data, not by fetching
    this.loadExerciseData();
    this.setupEventListeners();
  }

  loadExerciseData() {
    try {
      // Determine which exercise data to use based on the page URL
      const currentPath = window.location.pathname;
      let exerciseData = [];
      
      if (currentPath.includes('futur-proche')) {
        exerciseData = JSON.parse(document.getElementById('exercise-data-futur-proche').textContent);
      } else if (currentPath.includes('imparfait')) {
        exerciseData = JSON.parse(document.getElementById('exercise-data-imparfait').textContent);
      } else if (currentPath.includes('passe-compose')) {
        exerciseData = JSON.parse(document.getElementById('exercise-data-passe-compose').textContent);
      } else if (currentPath.includes('futur-simple')) {
        exerciseData = JSON.parse(document.getElementById('exercise-data-future-simple').textContent);
      } else {
        // Default to passe-compose if no match
        exerciseData = JSON.parse(document.getElementById('exercise-data-passe-compose').textContent);
      }
      
      if (exerciseData && exerciseData.length > 0) {
        this.exercises = exerciseData;
        console.log('Loaded exercises:', this.exercises.length);
        this.updateExercise();
      } else {
        console.error('No exercise data found');
        document.getElementById('sentence-display').innerHTML = 'Error: No exercise data available.';
      }
    } catch (error) {
      console.error('Error loading exercise data:', error);
      document.getElementById('sentence-display').innerHTML = 'Error: Could not load exercise data.';
    }
  }

  setupEventListeners() {
    const newExerciseBtn = document.getElementById('new-exercise-btn');
    const checkAnswerBtn = document.getElementById('check-answer-btn');
    const showAnswerBtn = document.getElementById('show-answer-btn');
    const answerInput = document.getElementById('answer-input');
    
    if (newExerciseBtn) {
      newExerciseBtn.addEventListener('click', () => this.updateExercise());
    }
    
    if (checkAnswerBtn) {
      checkAnswerBtn.addEventListener('click', () => this.checkAnswer());
    }
    
    if (showAnswerBtn) {
      showAnswerBtn.addEventListener('click', () => this.showAnswer());
    }
    
    if (answerInput) {
      answerInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          this.checkAnswer();
        }
      });
    }
  }

  getRandomExercise() {
    if (this.exercises.length === 0) return null;
    
    let newIndex;
    do {
      newIndex = Math.floor(Math.random() * this.exercises.length);
    } while (newIndex === this.currentExerciseIndex && this.exercises.length > 1);
    
    this.currentExerciseIndex = newIndex;
    return this.exercises[newIndex];
  }

  updateExercise() {
    const sentenceDisplay = document.getElementById('sentence-display');
    const answerInput = document.getElementById('answer-input');
    const feedback = document.getElementById('feedback');
    
    if (!sentenceDisplay || !answerInput || !feedback) return;
    
    const newExercise = this.getRandomExercise();
    if (!newExercise) return;
    
    // Clear previous feedback and input
    feedback.innerHTML = '';
    answerInput.value = '';
    
    // Update sentence display
    sentenceDisplay.innerHTML = newExercise.sentence;
    
    // Store current exercise data
    sentenceDisplay.dataset.answer = newExercise.answer;
    sentenceDisplay.dataset.explanation = newExercise.explanation;
  }

  checkAnswer() {
    const answerInput = document.getElementById('answer-input');
    const feedback = document.getElementById('feedback');
    const sentenceDisplay = document.getElementById('sentence-display');
    
    if (!answerInput || !feedback || !sentenceDisplay) return;
    
    const userAnswer = answerInput.value.trim().toLowerCase();
    const correctAnswer = sentenceDisplay.dataset.answer.toLowerCase();
    const explanation = sentenceDisplay.dataset.explanation;
    
    if (userAnswer === correctAnswer) {
      feedback.innerHTML = '<div class="correct-answer">✅ Correct! Excellent work!</div>';
      feedback.className = 'feedback correct';
    } else {
      feedback.innerHTML = `<div class="incorrect-answer">❌ Not quite right. The correct answer is: <strong>${correctAnswer}</strong></div><div class="explanation">${explanation}</div>`;
      feedback.className = 'feedback incorrect';
    }
  }

  showAnswer() {
    const feedback = document.getElementById('feedback');
    const sentenceDisplay = document.getElementById('sentence-display');
    
    if (!feedback || !sentenceDisplay) return;
    
    const correctAnswer = sentenceDisplay.dataset.answer;
    const explanation = sentenceDisplay.dataset.explanation;
    
    feedback.innerHTML = `<div class="show-answer">Answer: <strong>${correctAnswer}</strong></div><div class="explanation">${explanation}</div>`;
    feedback.className = 'feedback show-answer';
  }
}

// Initialize the exercise system when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
  new FrenchExerciseSystem();
});
</script>
